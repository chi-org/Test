name: Workflow For PoC

on: 
  push: 
    branches:
    - main
  pull_request: 
    branches:
    - main

# concurrency:
#   group: ${{ github.workflow }}-${{ github.event.pull_request.number }}

jobs:
  job1:
    outputs:
      run_job2: ${{ steps.test.outputs.run_job2 }}
      run_job3: ${{ steps.test.outputs.run_job3 }}
    runs-on: ubuntu-dind
    permissions:
      contents: read
      packages: write
    steps:
    - name: Test 
      id: test
      run: |
        echo test
        echo "run_job2=false" >> $GITHUB_OUTPUT
        echo "run_job3=true" >> $GITHUB_OUTPUT

    - name: Send mail to committer
      continue-on-error: true
      uses: dawidd6/action-send-mail@v6
      with:
        server_address: smtp.gmail.com
        server_port: 465
        secure: true
        username: ${{ vars.MAIL_USERNAME }}
        password: ${{ secrets.MAIL_PASSWORD }}
        subject: "TEST MAIL"
        body: |
            Hi ${{ env.COMMITTER_NAME || 'contributors' }},

            The workflow #${{ github.run_number }} that run commit #${{ env.COMMIT_ID }} from repo ${{ github.repository }} has failed.
            Link to the commit: ${{ github.server_url }}/${{ github.repository }}/commit/${{ env.COMMIT_FULL_ID }}

            After the failure, the workflow will wait for ${{ env.WAIT_SECONDS }}s before cleaning up the environment.
            Please check the workflow details and take appropriate action at: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}

            For more information, please contact the SRE team.
            
            Best regards,
            SRE Team
        to: phamtranlinhchi02@gmail.com
        from: phamtranlinhchi02@gmail.com
  
  # job2:
  #   needs: job1
  #   if: needs.job1.outputs.run_job2 == 'true'
  #   runs-on: self-hosted
  #   permissions:
  #     contents: read
  #     packages: write
  #   steps:
  #   - name: Test 
  #     run: |
  #       echo test heheh

  # job3:
  #   needs: 
  #     - job2
  #   if: always() && !cancelled() && needs.job1.outputs.run_job3 == 'true'
  #   runs-on: self-hosted
  #   permissions:
  #     contents: read
  #     packages: write
  #   steps:
  #   - name: Test 
  #     run: |
  
  #       echo test